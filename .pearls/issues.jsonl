{"id":"gsv-2697","title":"git-block: generic vendor file protection tool","status":"open","issue_type":"epic","priority":2,"created_at":"2026-02-09T08:00:27Z"}
{"id":"gsv-2697.1","title":"Implement check-vendor.yml workflow + config schema","status":"open","issue_type":"feature","priority":2,"created_at":"2026-02-09T08:14:26Z","parent":"gsv-2697","body":"The core git-block deliverable \u2014 a generic GHA workflow that reads .block/config.json and checks PR changed files against per-vendor protected/allowed patterns.\n\n## Acceptance Criteria\n\n- [ ] Config schema defined: `.block/config.json` with `vendors.<name>.{install_branch, protected, allowed}` structure\n- [ ] `git-block/templates/github/workflows/check-vendor.yml` implemented:\n  - Reads `.block/config.json`\n  - For each vendor: skips if PR branch starts with `install_branch`\n  - Checks changed files against `protected` globs; violations if file matches protected but not matched by `allowed`\n  - Clear error output listing violations per vendor\n- [ ] Tests: check logic tested with mock configs + file lists (vendor skip, violation detection, allowed passthrough, multi-vendor)\n- [ ] Docs: `git-block/README.md` with config schema reference\n\n## Context\n\nReplaces bespoke per-vendor check workflows like check-pearls-impl.yml (~200 lines of tool-specific bash). The check logic is generic and config-driven.\n\nCheck logic (pseudo):\n```\nfor each vendor in config.vendors:\n  if PR branch starts with vendor.install_branch \u2192 skip this vendor\n  for each changed file:\n    if file matches any vendor.protected pattern:\n      if file does NOT match any vendor.allowed pattern:\n        \u2192 violation\n```\n\nConfig schema:\n```json\n{\n  \"vendors\": {\n    \"<vendor-name>\": {\n      \"install_branch\": \"<branch-prefix>\",\n      \"protected\": [\"<glob-pattern>\", ...],\n      \"allowed\": [\"<glob-pattern>\", ...]\n    }\n  }\n}\n```","deps":[{"id":"gsv-2697.2","type":"blocks"},{"id":"gsv-2697.4","type":"blocks"}]}
{"id":"gsv-2697.2","title":"Implement git-block install.sh","status":"open","issue_type":"feature","priority":2,"created_at":"2026-02-09T08:14:44Z","parent":"gsv-2697","body":"The consumer-facing installer for git-block. Sets up .block/ directory, config, and workflow in a target repo.\n\n## Acceptance Criteria\n\n- [ ] `git-block/install.sh` implemented:\n  - Creates `.block/` directory\n  - Initializes `.block/config.json` with empty `vendors` object if missing (preserves existing config on update)\n  - Installs `check-vendor.yml` to `.github/workflows/` (always overwrites \u2014 it's implementation, not config)\n  - Registers git-block itself as a vendor:\n    - `install_branch`: `chore/install-git-block`\n    - `protected`: `.block/**`, `.github/workflows/check-vendor.yml`\n    - `allowed`: `.block/config.json`\n  - Writes version to `.block/.version`\n- [ ] `git-block/VERSION` file created\n- [ ] Tests: fresh install creates expected structure, update preserves existing config, self-registration is correct\n- [ ] Docs: installation section in `git-block/README.md`\n\n## Context\n\nFollows the same pattern as git-semver's install.sh \u2014 download + place files, create config if missing, preserve config on update. The install script is the entry point for consumer repos adopting git-block.","deps":[{"id":"gsv-2697.1","type":"blocked_by"},{"id":"gsv-2697.4","type":"blocks"}]}
{"id":"gsv-2697.3","title":"Add git-block self-registration to git-semver install.sh","status":"open","issue_type":"feature","priority":2,"created_at":"2026-02-09T08:15:04Z","parent":"gsv-2697","body":"When git-semver installs in a consumer repo, register its protected/allowed files with git-block if .block/config.json is present.\n\n## Acceptance Criteria\n\n- [ ] `install.sh` updated: if `.block/config.json` exists, register git-semver vendor config:\n  - `install_branch`: `chore/install-git-semver`\n  - `protected`: `.semver/**`, git-semver workflow files (`.github/workflows/version-bump.yml`, `.github/workflows/install-git-semver.yml`)\n  - `allowed`: `.semver/config.json`, `.semver/.version`\n- [ ] Registration uses the inline python pattern from the git-block design doc:\n  ```python\n  import json\n  with open('.block/config.json') as f:\n      config = json.load(f)\n  config.setdefault('vendors', {})\n  config['vendors']['git-semver'] = { ... }\n  with open('.block/config.json', 'w') as f:\n      json.dump(config, f, indent=2)\n      f.write('\\n')\n  ```\n- [ ] No-op when `.block/config.json` doesn't exist (git-block not installed)\n- [ ] Tests: registration adds correct config entries, no-op without git-block, preserves existing vendor registrations\n- [ ] Docs: mention git-block integration in git-semver README\n\n## Context\n\nThis is the vendor self-registration pattern \u2014 each tool's install script registers its own files with git-block. The check workflow stays generic and config-driven.","references":[{"file":"install.sh"}]}
{"id":"gsv-2697.4","title":"Replace check-pearls-impl.yml with git-block in this repo","status":"open","issue_type":"feature","priority":2,"created_at":"2026-02-09T08:15:24Z","parent":"gsv-2697","body":"Migrate this repo (as a consumer) from the bespoke check-pearls-impl.yml to git-block's generic check-vendor.yml.\n\n## Acceptance Criteria\n\n- [ ] git-block installed in this repo (`.block/` directory, `check-vendor.yml` workflow)\n- [ ] Pearls vendor registered in `.block/config.json` matching current check-pearls-impl.yml protections:\n  - `install_branch`: `chore/install-pearls`\n  - `protected`: `.pearls/**`\n  - `allowed`: `.pearls/issues.jsonl`, `.pearls/config.json`, `.pearls/.prl-version`, `.pearls/archive/*.jsonl`\n- [ ] `.github/workflows/check-pearls-impl.yml` removed\n- [ ] Verification: document that check-vendor.yml catches the same violation cases as the removed workflow (protected files flagged, allowed files pass, install branch skipped)\n\n## Depends on\n\n- gsv-2697.1 (check-vendor.yml workflow)\n- gsv-2697.2 (git-block install.sh)\n\n## Context\n\ncheck-pearls-impl.yml is ~200 lines of bespoke bash that hard-codes knowledge of .pearls/, .semver/, hooks, and workflows. git-block replaces this with a ~50 line config-driven workflow. The pearls vendor config registered here will eventually be managed by pearls' own install.sh (tracked as a separate pearls issue), but for initial migration we register it manually.","deps":[{"id":"gsv-2697.1","type":"blocked_by"},{"id":"gsv-2697.2","type":"blocked_by"}],"references":[{"file":".github/workflows/check-pearls-impl.yml"}]}
